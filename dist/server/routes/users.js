"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _i18next = _interopRequireDefault(require("i18next"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// @ts-check
var _default = app => {
  app.get('/users', {
    name: 'users'
  }, async (req, reply) => {
    const users = await app.objection.models.user.query();
    reply.render('users/index', {
      users
    });
    return reply;
  }).get('/users/new', {
    name: 'newUser'
  }, (req, reply) => {
    const user = new app.objection.models.user();
    reply.render('users/new', {
      user
    });
  }).post('/users', async (req, reply) => {
    try {
      const user = await app.objection.models.user.fromJson(req.body.data);
      await app.objection.models.user.query().insert(user);
      req.flash('info', _i18next.default.t('flash.users.create.success'));
      reply.redirect(app.reverse('root'));
      return reply;
    } catch ({
      data
    }) {
      req.flash('error', _i18next.default.t('flash.users.create.error'));
      reply.render('users/new', {
        user: req.body.data,
        errors: data
      });
      return reply;
    }
  });
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9yb3V0ZXMvdXNlcnMuanMiXSwibmFtZXMiOlsiYXBwIiwiZ2V0IiwibmFtZSIsInJlcSIsInJlcGx5IiwidXNlcnMiLCJvYmplY3Rpb24iLCJtb2RlbHMiLCJ1c2VyIiwicXVlcnkiLCJyZW5kZXIiLCJwb3N0IiwiZnJvbUpzb24iLCJib2R5IiwiZGF0YSIsImluc2VydCIsImZsYXNoIiwiaTE4bmV4dCIsInQiLCJyZWRpcmVjdCIsInJldmVyc2UiLCJlcnJvcnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7OztBQUZBO2VBSWdCQSxHQUFELElBQVM7QUFDdEJBLEVBQUFBLEdBQUcsQ0FDQUMsR0FESCxDQUNPLFFBRFAsRUFDaUI7QUFBRUMsSUFBQUEsSUFBSSxFQUFFO0FBQVIsR0FEakIsRUFDb0MsT0FBT0MsR0FBUCxFQUFZQyxLQUFaLEtBQXNCO0FBQ3RELFVBQU1DLEtBQUssR0FBRyxNQUFNTCxHQUFHLENBQUNNLFNBQUosQ0FBY0MsTUFBZCxDQUFxQkMsSUFBckIsQ0FBMEJDLEtBQTFCLEVBQXBCO0FBQ0FMLElBQUFBLEtBQUssQ0FBQ00sTUFBTixDQUFhLGFBQWIsRUFBNEI7QUFBRUwsTUFBQUE7QUFBRixLQUE1QjtBQUNBLFdBQU9ELEtBQVA7QUFDRCxHQUxILEVBTUdILEdBTkgsQ0FNTyxZQU5QLEVBTXFCO0FBQUVDLElBQUFBLElBQUksRUFBRTtBQUFSLEdBTnJCLEVBTTBDLENBQUNDLEdBQUQsRUFBTUMsS0FBTixLQUFnQjtBQUN0RCxVQUFNSSxJQUFJLEdBQUcsSUFBSVIsR0FBRyxDQUFDTSxTQUFKLENBQWNDLE1BQWQsQ0FBcUJDLElBQXpCLEVBQWI7QUFDQUosSUFBQUEsS0FBSyxDQUFDTSxNQUFOLENBQWEsV0FBYixFQUEwQjtBQUFFRixNQUFBQTtBQUFGLEtBQTFCO0FBQ0QsR0FUSCxFQVVHRyxJQVZILENBVVEsUUFWUixFQVVrQixPQUFPUixHQUFQLEVBQVlDLEtBQVosS0FBc0I7QUFDcEMsUUFBSTtBQUNGLFlBQU1JLElBQUksR0FBRyxNQUFNUixHQUFHLENBQUNNLFNBQUosQ0FBY0MsTUFBZCxDQUFxQkMsSUFBckIsQ0FBMEJJLFFBQTFCLENBQW1DVCxHQUFHLENBQUNVLElBQUosQ0FBU0MsSUFBNUMsQ0FBbkI7QUFDQSxZQUFNZCxHQUFHLENBQUNNLFNBQUosQ0FBY0MsTUFBZCxDQUFxQkMsSUFBckIsQ0FBMEJDLEtBQTFCLEdBQWtDTSxNQUFsQyxDQUF5Q1AsSUFBekMsQ0FBTjtBQUNBTCxNQUFBQSxHQUFHLENBQUNhLEtBQUosQ0FBVSxNQUFWLEVBQWtCQyxpQkFBUUMsQ0FBUixDQUFVLDRCQUFWLENBQWxCO0FBQ0FkLE1BQUFBLEtBQUssQ0FBQ2UsUUFBTixDQUFlbkIsR0FBRyxDQUFDb0IsT0FBSixDQUFZLE1BQVosQ0FBZjtBQUNBLGFBQU9oQixLQUFQO0FBQ0QsS0FORCxDQU1FLE9BQU87QUFBRVUsTUFBQUE7QUFBRixLQUFQLEVBQWlCO0FBQ2pCWCxNQUFBQSxHQUFHLENBQUNhLEtBQUosQ0FBVSxPQUFWLEVBQW1CQyxpQkFBUUMsQ0FBUixDQUFVLDBCQUFWLENBQW5CO0FBQ0FkLE1BQUFBLEtBQUssQ0FBQ00sTUFBTixDQUFhLFdBQWIsRUFBMEI7QUFBRUYsUUFBQUEsSUFBSSxFQUFFTCxHQUFHLENBQUNVLElBQUosQ0FBU0MsSUFBakI7QUFBdUJPLFFBQUFBLE1BQU0sRUFBRVA7QUFBL0IsT0FBMUI7QUFDQSxhQUFPVixLQUFQO0FBQ0Q7QUFDRixHQXRCSDtBQXVCRCxDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLWNoZWNrXG5cbmltcG9ydCBpMThuZXh0IGZyb20gJ2kxOG5leHQnO1xuXG5leHBvcnQgZGVmYXVsdCAoYXBwKSA9PiB7XG4gIGFwcFxuICAgIC5nZXQoJy91c2VycycsIHsgbmFtZTogJ3VzZXJzJyB9LCBhc3luYyAocmVxLCByZXBseSkgPT4ge1xuICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBhcHAub2JqZWN0aW9uLm1vZGVscy51c2VyLnF1ZXJ5KCk7XG4gICAgICByZXBseS5yZW5kZXIoJ3VzZXJzL2luZGV4JywgeyB1c2VycyB9KTtcbiAgICAgIHJldHVybiByZXBseTtcbiAgICB9KVxuICAgIC5nZXQoJy91c2Vycy9uZXcnLCB7IG5hbWU6ICduZXdVc2VyJyB9LCAocmVxLCByZXBseSkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IG5ldyBhcHAub2JqZWN0aW9uLm1vZGVscy51c2VyKCk7XG4gICAgICByZXBseS5yZW5kZXIoJ3VzZXJzL25ldycsIHsgdXNlciB9KTtcbiAgICB9KVxuICAgIC5wb3N0KCcvdXNlcnMnLCBhc3luYyAocmVxLCByZXBseSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGFwcC5vYmplY3Rpb24ubW9kZWxzLnVzZXIuZnJvbUpzb24ocmVxLmJvZHkuZGF0YSk7XG4gICAgICAgIGF3YWl0IGFwcC5vYmplY3Rpb24ubW9kZWxzLnVzZXIucXVlcnkoKS5pbnNlcnQodXNlcik7XG4gICAgICAgIHJlcS5mbGFzaCgnaW5mbycsIGkxOG5leHQudCgnZmxhc2gudXNlcnMuY3JlYXRlLnN1Y2Nlc3MnKSk7XG4gICAgICAgIHJlcGx5LnJlZGlyZWN0KGFwcC5yZXZlcnNlKCdyb290JykpO1xuICAgICAgICByZXR1cm4gcmVwbHk7XG4gICAgICB9IGNhdGNoICh7IGRhdGEgfSkge1xuICAgICAgICByZXEuZmxhc2goJ2Vycm9yJywgaTE4bmV4dC50KCdmbGFzaC51c2Vycy5jcmVhdGUuZXJyb3InKSk7XG4gICAgICAgIHJlcGx5LnJlbmRlcigndXNlcnMvbmV3JywgeyB1c2VyOiByZXEuYm9keS5kYXRhLCBlcnJvcnM6IGRhdGEgfSk7XG4gICAgICAgIHJldHVybiByZXBseTtcbiAgICAgIH1cbiAgICB9KTtcbn07XG4iXX0=